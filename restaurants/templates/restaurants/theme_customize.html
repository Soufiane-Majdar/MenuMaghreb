{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Customize Menu Theme - {{ restaurant.name }}{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/spectrum-colorpicker2/dist/spectrum.min.css" rel="stylesheet">
<style>
    .preview-section {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .preview-section h3 {
        margin-bottom: 15px;
    }
    
    .theme-preview {
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        transition: all 0.3s ease;
    }
    
    .color-preview {
        width: 30px;
        height: 30px;
        border-radius: 4px;
        display: inline-block;
        margin-right: 10px;
        border: 1px solid #ddd;
    }
    
    .font-preview {
        font-size: 1.2rem;
        margin: 10px 0;
    }
    
    .style-preview-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <!-- Theme Form -->
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body">
                    <h2 class="card-title mb-4">Customize Menu Theme</h2>
                    
                    <form method="post" id="themeForm" novalidate>
                        {% csrf_token %}
                        {{ form|crispy }}
                        
                        <div class="d-flex justify-content-between mt-4">
                            <a href="{% url 'restaurant_menu_edit' restaurant.id %}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left"></i> Back to Menu
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Theme
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Live Preview -->
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body">
                    <h2 class="card-title mb-4">Live Preview</h2>
                    
                    <div class="preview-section">
                        <h3>Colors</h3>
                        <div id="colorPreview" class="theme-preview">
                            <div class="mb-3">
                                <span class="color-preview" id="primaryColorPreview"></span>
                                <span>Primary Color</span>
                            </div>
                            <div class="mb-3">
                                <span class="color-preview" id="secondaryColorPreview"></span>
                                <span>Secondary Color</span>
                            </div>
                            <div class="mb-3">
                                <span class="color-preview" id="backgroundColorPreview"></span>
                                <span>Background Color</span>
                            </div>
                            <div class="mb-3">
                                <span class="color-preview" id="textColorPreview"></span>
                                <span>Text Color</span>
                            </div>
                            <div class="mb-3">
                                <span class="color-preview" id="accentColorPreview"></span>
                                <span>Accent Color</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="preview-section">
                        <h3>Font Family</h3>
                        <div id="fontPreview" class="theme-preview">
                            <p class="font-preview">
                                This is how your menu text will look
                            </p>
                        </div>
                    </div>
                    
                    <div class="preview-section">
                        <h3>Menu Style</h3>
                        <div id="stylePreview" class="theme-preview">
                            <div class="style-preview-card">
                                <h4>Sample Menu Item</h4>
                                <p>Description of the menu item goes here</p>
                                <span class="price">150 DH</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/spectrum-colorpicker2/dist/spectrum.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize color pickers
    $('.color-picker').spectrum({
        type: "component",
        showInput: true,
        showInitial: true,
        showAlpha: false,
        allowEmpty: false
    });
    
    // Update preview function
    function updatePreview() {
        // Update colors
        const primaryColor = $('#id_primary_color').val();
        const secondaryColor = $('#id_secondary_color').val();
        const backgroundColor = $('#id_background_color').val();
        const textColor = $('#id_text_color').val();
        const accentColor = $('#id_accent_color').val();
        
        $('#primaryColorPreview').css('background-color', primaryColor);
        $('#secondaryColorPreview').css('background-color', secondaryColor);
        $('#backgroundColorPreview').css('background-color', backgroundColor);
        $('#textColorPreview').css('background-color', textColor);
        $('#accentColorPreview').css('background-color', accentColor);
        
        // Update font
        const fontFamily = $('#id_font_family').val();
        $('#fontPreview').css('font-family', fontFamily);
        
        // Update style preview
        const menuStyle = $('#id_menu_style').val();
        const stylePreview = $('#stylePreview');
        
        stylePreview.removeClass('modern classic elegant minimal').addClass(menuStyle);
        
        // Apply colors to preview
        $('.style-preview-card').css({
            'background-color': backgroundColor,
            'color': textColor,
            'border-color': secondaryColor
        });
        
        $('.style-preview-card h4').css('color', primaryColor);
        $('.style-preview-card .price').css('color', accentColor);
    }
    
    // Listen for changes
    $('.color-picker').on('change', updatePreview);
    $('#id_font_family, #id_menu_style').on('change', updatePreview);
    
    // Initial preview
    updatePreview();
});
</script>
{% endblock %}
